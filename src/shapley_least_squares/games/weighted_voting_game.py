from typing import override

import numpy as np

from shapley_least_squares.games.utils.base_game import BaseGame


class WeightedVotingGame(BaseGame):
    def __init__(self, weights: list[int] | np.ndarray, quota: int) -> None:
        if not all(weight > 0 for weight in weights):
            raise ValueError("All weights must be positive.")

        if sum(weights) < quota:
            raise ValueError("The sum of all weights must be >= quota.")

        super().__init__(len(weights))
        self._weights = np.array(weights)
        self._quota = quota

    @override
    def v(self, S: list[int] | np.ndarray) -> float:
        return float(np.sum(self._weights[S]) >= self._quota)


class CustomWeightedVotingGameNormalSqrd(WeightedVotingGame):
    def __init__(self) -> None:
        self.shapley_values = np.array(
            [
                0.0195633,
                0.00758229,
                0.0315659,
                0.0183738,
                0.0172237,
                0.0203783,
                0.0126878,
                0.0280294,
                0.0146914,
                0.0164787,
                0.0285206,
                0.0247204,
                0.0265837,
                0.0176027,
                0.0229297,
                0.0251793,
                0.0120538,
                0.0207923,
                0.0331522,
                0.0164787,
                0.0111343,
                0.0229297,
                0.0176027,
                0.0187659,
                0.026111,
                0.00758229,
                0.0130112,
                0.00834009,
                0.0126878,
                0.0187659,
                0.0150403,
                0.0233705,
                0.0256429,
                0.0242659,
                0.0275429,
                0.00886581,
                0.0295169,
                0.0191624,
                0.0146914,
                0.016849,
                0.023816,
                0.0285206,
                0.0105422,
                0.0399336,
                0.0300221,
                0.00808335,
                0.0179861,
                0.0176027,
                0.0358923,
                0.0111343,
            ]
        )

        super().__init__(
            weights=[
                9801,
                3844,
                15625,
                9216,
                8649,
                10201,
                6400,
                13924,
                7396,
                8281,
                14161,
                12321,
                13225,
                8836,
                11449,
                12544,
                6084,
                10404,
                16384,
                8281,
                5625,
                11449,
                8836,
                9409,
                12996,
                3844,
                6561,
                4225,
                6400,
                9409,
                7569,
                11664,
                12769,
                12100,
                13689,
                4489,
                14641,
                9604,
                7396,
                8464,
                11881,
                14161,
                5329,
                19600,
                14884,
                4096,
                9025,
                8836,
                17689,
                5625,
            ],
            quota=249646,
        )


class CustomWeightedVotingGameUniform(WeightedVotingGame):
    def __init__(self) -> None:
        self.shapley_values = np.array(
            [
                0.00618557,
                0.0121804,
                0.00118682,
                0.0100803,
                0.0048616,
                0.000468873,
                0.00408279,
                0.00114537,
                0.0101084,
                0.00516789,
                0.00940564,
                0.0137508,
                0.0066882,
                0.0127458,
                0.00262579,
                0.00204417,
                0.0126609,
                0.00951801,
                0.0133825,
                0.00632514,
                0.00782099,
                0.0111645,
                0.0131702,
                0.00308325,
                0.00978502,
                0.00693971,
                0.00280595,
                0.00874592,
                0.00198881,
                0.00073108,
                0.00226566,
                0.0120816,
                0.000510265,
                0.00301391,
                0.0137933,
                0.00239029,
                0.00168446,
                0.00758303,
                0.00585076,
                0.00845144,
                0.0109954,
                0.0129438,
                0.00372161,
                0.00420787,
                0.0102772,
                0.0129721,
                0.000289546,
                0.0130711,
                0.00793301,
                0.00209953,
                0.00365219,
                0.0114042,
                0.0101084,
                0.000206802,
                0.0061437,
                0.00790501,
                0.00695369,
                0.0112209,
                0.00568344,
                0.000675867,
                0.00793301,
                0.00365219,
                0.00965852,
                0.0127033,
                0.00796102,
                0.00885815,
                0.00807308,
                0.00434689,
                0.00730323,
                0.00898444,
                0.00322195,
                0.000841524,
                0.00822719,
                0.00766701,
                0.0118274,
                0.0106151,
                0.00518181,
                0.00754105,
                0.0133401,
                0.00178128,
                0.000248172,
                0.00782099,
                0.00483376,
                0.00895637,
                0.00390217,
                0.0058926,
                0.00526538,
                0.00178128,
                0.00838135,
                0.000993424,
                0.00501472,
                0.00631118,
                0.0126044,
                0.0037355,
                0.0012559,
                0.00968663,
                0.00958826,
                0.000662065,
                0.00441642,
                0.012774,
                0.0122087,
                0.00730323,
                0.00326357,
                0.00182278,
                0.00759703,
                0.0121946,
                0.00901251,
                0.00597629,
                0.0056695,
                0.0109531,
                0.0036383,
                0.00388828,
                0.000317131,
                0.0093635,
                0.00197497,
                0.00113155,
                0.00933541,
                0.0102772,
                0.00835332,
                0.00073108,
                0.00394385,
                0.010418,
                0.00575315,
                0.00189195,
                0.00693971,
                0.00212722,
                0.00104867,
                0.0128731,
                0.00237644,
                0.00706551,
                0.00269507,
                0.00749907,
                0.0111645,
                0.00257037,
                0.00433299,
                0.00113155,
                0.00852154,
                0.00459722,
                0.0126044,
                0.00780699,
                0.00573921,
                0.00343008,
                0.0118839,
                0.00796102,
                0.00894234,
                0.0127458,
                0.0083393,
                0.0082412,
                0.00892831,
                0.00663233,
            ]
        )

        super().__init__(
            weights=[
                446,
                873,
                86,
                724,
                351,
                34,
                295,
                83,
                726,
                373,
                676,
                984,
                482,
                913,
                190,
                148,
                907,
                684,
                958,
                456,
                563,
                801,
                943,
                223,
                703,
                500,
                203,
                629,
                144,
                53,
                164,
                866,
                37,
                218,
                987,
                173,
                122,
                546,
                422,
                608,
                789,
                927,
                269,
                304,
                738,
                929,
                21,
                936,
                571,
                152,
                264,
                818,
                726,
                15,
                443,
                569,
                501,
                805,
                410,
                49,
                571,
                264,
                694,
                910,
                573,
                637,
                581,
                314,
                526,
                646,
                233,
                61,
                592,
                552,
                848,
                762,
                374,
                543,
                955,
                129,
                18,
                563,
                349,
                644,
                282,
                425,
                380,
                129,
                603,
                72,
                362,
                455,
                903,
                270,
                91,
                696,
                689,
                48,
                319,
                915,
                875,
                526,
                236,
                132,
                547,
                874,
                648,
                431,
                409,
                786,
                263,
                281,
                23,
                673,
                143,
                82,
                671,
                738,
                601,
                53,
                285,
                748,
                415,
                137,
                500,
                154,
                76,
                922,
                172,
                509,
                195,
                540,
                801,
                186,
                313,
                82,
                613,
                332,
                903,
                562,
                414,
                248,
                852,
                573,
                643,
                913,
                600,
                593,
                642,
                478,
            ],
            quota=35951,
        )
